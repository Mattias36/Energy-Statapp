{% extends "base.html" %}

{% block page_content %}
<div class="countries-container">
    <h1>Countries with data for category: {{ category.name }}</h1>

    <!-- Search box -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search for a country...">
    </div>

    <!-- List of countries displayed as a tile grid -->
    <div id="countriesGrid" class="countries-grid">
        {% for country in countries %}
        <div class="country-card">
            <a href="{% url 'country_view' country.code %}?category={{ category.id }}">
                <img src="https://flagcdn.com/w320/{{ country.code|lower }}.png" 
                     onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Greece.svg'" 
                     alt="{{ country.name }} Flag">
                <h3>{{ country.name }}</h3>
            </a>
        </div>
        {% empty %}
        <p>No available data for this category.</p>
        {% endfor %}
    </div>

    <!-- Back button -->
    <p>
        <a href="{% url 'categories' %}" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to category list
        </a>
    </p>
</div>

<script>
    let searchInput = document.getElementById("searchInput");
    function filterCountries() {
        let input = searchInput.value.toLowerCase();
        let items = document.querySelectorAll(".country-card");

        items.forEach(function(item) {
            let text = item.querySelector("h3").textContent.toLowerCase();
            if (text.includes(input)) {
                item.style.display = "block";
            } else {
                item.style.display = "none";
            }
        });
    }
    searchInput.addEventListener("keyup", filterCountries);
</script>
{% endblock %}
